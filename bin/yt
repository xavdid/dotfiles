#!/usr/bin/env bash

set -euo pipefail

# Downloads a youtube video in mp4 format and puts it in the archive.
# Or, with -n/--now, onto the desktop (to be watched now)

if [ $# -eq 0 ]; then
  echo "Usage: yt [--now|-n] <video_url>"
  exit 1
fi

require-variables DROPBOX || exit 1

# Defaults
OUTPUT_DIR="$DROPBOX/Archive/Videos/Youtube Backup/%(title)s.%(ext)s"
VIDEO_URL=""

# Parse arguments
for arg in "$@"; do
  case "$arg" in
    --now|-n)
      OUTPUT_DIR="$HOME/Desktop/%(title)s.%(ext)s"
      ;;
    *)
      VIDEO_URL="$arg"
      ;;
  esac
done

if [ -z "$VIDEO_URL" ]; then
  echo "Error: Missing video URL"
  exit 1
fi

yt-dlp -S ext,vcodec:h264 -o "$OUTPUT_DIR" "$VIDEO_URL"
